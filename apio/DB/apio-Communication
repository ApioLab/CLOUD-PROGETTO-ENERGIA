{"_id":{"$oid":"5755f1fdab9c72a7557283c7"},"apio":{"9":{"energy":{"13":"energy1"}},"3082":{"type":"DIN8","onoff":{"3082":"onoff"},"rele1":{"13":"plug4","3082":"rele1"},"rel4":{"15":"luci"}}},"enocean":{"018ca01c":{"type":"a5-06-01","objectId":"19","lux":{"13":"energy1"}},"01925593":{"type":"d2-01-0b","objectId":"30"},"019275D1":{"type":"d2-01-0b","objectId":"13"},"00298b82":{"type":"f6-02-01","objectId":"27"},"0180649c":{"type":"d5-00-01","objectId":"29"},"0180646a":{"type":"d5-00-01","objectId":"28"},"0195957d":{"objectId":"36","type":"a5-02-05"},"01916c91":{"objectId":"37","type":"a5-20-01","actuatorObstructed":{},"energySufficent":{},"setPoint":{},"setPointSelection":{},"temperature":{},"valveOpenClose":{}}},"name":"addressBindToProperty"}
{"_id":{"$oid":"575436d3ab9c72a7557283c6"},"name":"integratedCommunication","zwave":{"FGWPE Wall Plug":{"send":{},"recive":{}}},"apio":{"DIN8":{"send":{"update":"(function(data,allProperties){var propertyname=Object.keys(data.properties)[0];var propertyvalue=data.properties[propertyname];return data.sendProtocol+data.address+':'+propertyname+':'+propertyvalue+'-';})","hi":"function(){console.log('RECIVE A HI')}"},"recive":{"update":"function(){console.log('RECIVE A MESSAGE')}","hi":"function(){console.log('RECIVE A HI')}"}},"generic":{"send":{"update":"function(){console.log('RECIVE A MESSAGE')}","hi":"function(){console.log('RECIVE A HI')}"},"recive":{"update":"function(){console.log('RECIVE A MESSAGE')}","hi":"function(){console.log('RECIVE A HI')}"}}},"enocean":{"d2-01-0b":{"send":{"01":"(function(data,enocean){ var optionalLenght = 'calculate'; var packetType = '01';  var dataLenght = 'calculate';  var choise = 'd2';var row = ''; if(data.message.value == '0'){ row = '011e00'; } else if(data.message.value == '1'){ row = '011e64'; } var senderId = enocean.base;  var status = '00';  var subTelNum = '03';  var destinationId = data.protocol.address;  var securityLevel = '00';  var dBm = 'ff';  var optionalData = subTelNum + destinationId + dBm + securityLevel;  var data = choise + row + senderId + status;  dataLenght = data;  console.log('data lenght', (dataLenght.length) / 2);  dataLenght = ((dataLenght.length) / 2).toString(16);  if (dataLenght.length === 1) { dataLenght = '000' + dataLenght;  } else if (dataLenght.length === 2) { dataLenght = '00' + dataLenght;  } else if (dataLenght.length === 3) { dataLenght = '0' + dataLenght;  }  optionalLenght = optionalData;  console.log('optionalLenght lenght in decimale', (optionalLenght.length) / 2);  optionalLenght = ((optionalLenght.length) / 2).toString(16);  if (optionalLenght.length === 1) { optionalLenght = '0' + optionalLenght;  }  console.log('optionalLenght length hex', optionalLenght);  data += optionalData;  var header = dataLenght + optionalLenght + packetType;  return { header : header, data : data } })","02":"function(){console.log('SET LOCAL')}","setup":"(function(dataObject,enocean,addInfo){   var property = {  plug1 : '',  energy1 : '',  power1 : '',  mesureMode : '' };  console.log('dataObject: ',dataObject);  if(addInfo !== undefined && addInfo.hasOwnProperty('mesureMode')){ property.mesureMode = addInfo.mesureMode; } else { property.mesureMode = '1'; } var DB_0 = '01'; var DB_1 = '01'; var DB_2 = '00'; var DB_3 = '03'; var DB_4 = parseInt('10' + property.mesureMode + '11110',2).toString(16); var DB_5 = '05'; var optionalLenght = 'calculate';   var packetType = '01';    var dataLenght = 'calculate';    var choise = 'd2';  var row = DB_5 + DB_4 + DB_3 + DB_2 + DB_1 + DB_0;   console.log('row: ',row);  var senderId = enocean.base;    var status = '00';    var subTelNum = '03';    var destinationId = dataObject.protocol.address;    var securityLevel = '00';    var dBm = 'ff';    var optionalData = subTelNum + destinationId + dBm + securityLevel;    var data = choise + row + senderId + status;  dataLenght = data;    console.log('data lenght', (dataLenght.length) / 2);    dataLenght = ((dataLenght.length) / 2).toString(16);    if (dataLenght.length === 1) {   dataLenght = '000' + dataLenght;    } else if (dataLenght.length === 2) {   dataLenght = '00' + dataLenght;    } else if (dataLenght.length === 3) {   dataLenght = '0' + dataLenght;   }    optionalLenght = optionalData;    console.log('optionalLenght lenght in decimale', (optionalLenght.length) / 2);    optionalLenght = ((optionalLenght.length) / 2).toString(16);    if (optionalLenght.length === 1) {   optionalLenght = '0' + optionalLenght;    }    console.log('optionalLenght length hex', optionalLenght);    data += optionalData;    var header = dataLenght + optionalLenght + packetType;    return { header : header, data : data } })"},"recive":{"01":"(function(dataObject,enocean){   var property = {  energy1 : '',  power1 : '' };  dataObject = dataObject.rawByte; console.log('dataObject: ',dataObject);  var dataLenght = parseInt(dataObject.substring(2, 6),16); var fun = dataObject.substring(14, 16); var dataRow = dataObject.substring(14, 14 + dataLenght + 1); console.log('dataRow: ', dataRow); console.log('FUN: ',fun); if(fun == '07'){ var mesureUnit = parseInt(dataRow.substring(2, 4)).toString(2); console.log('mesureUnit', mesureUnit); var mesure = dataRow.substring(4, 13); console.log('mesure: ',mesure); console.log('mesureUnit.length: ',mesureUnit.length); if(mesureUnit.length < 8){ console.log('mesureUnit, ha meno zeri del previsto, aggiungo gli zeri: ', mesureUnit); var addToZero = 8 - mesureUnit.length; for(var s = 2; s <= addToZero; s++){ mesureUnit = '0' + mesureUnit; } console.log('mesureUnit corretta: ',mesureUnit); } mesureUnit = mesureUnit[0] + mesureUnit[1] + mesureUnit[2]; mesureUnit = parseInt(mesureUnit,2).toString(16); console.log('unitÃ  di misura: ', mesureUnit); if(mesureUnit == '3'){ mesure = parseInt(mesure,16); property.power1 = ((mesure*3000*100000)/4294967295).toFixed(2); } } return property; })"}},"a5-06-01":{"send":{"01":"","02":"function(){console.log('SET LOCAL')}"},"recive":{"01":"(function(data,enocean){ var convertData = []; convertData[0] = data.raw[0] + data.raw[1]; convertData[1] = data.raw[2] + data.raw[3]; convertData[2] = data.raw[4] + data.raw[5]; convertData[3] = data.raw[6] + data.raw[7]; var data = { suplyVoltage : '', lux : '' }; console.log('CONVERTDATA ', convertData); console.log('CONVERTDATA1 ', convertData[1]); console.log('CONVERTDATA2 ', convertData[2]); var rangeSelect = parseInt(convertData[3],16).toString(2); console.log('RANGE SELECTED ',rangeSelect); if(rangeSelect[3] == 1){ data.lux = String((parseInt(convertData[1],16)*(30000/255)+(300-(parseInt(convertData[1],16)*300/255))).toFixed( 2 )); } else if(rangeSelect[3] == 0){ data.lux = String((parseInt(convertData[1],16)*(60000/255)+(600-(parseInt(convertData[1],16)*600/255))).toFixed( 2 )); } data.suplyVoltage = String((parseInt(convertData[0],16)*5.1/255).toFixed( 2 )); console.log('return***** ',data); return data; })"}},"a5-02-05":{"send":{"01":"(function(){})"},"recive":{"01":"(function(dataObject, enocean) { var property = { temperature: '' }; var temperature = parseInt(dataObject.raw.substring(4, 6),16); console.log('temperature hex: ', temperature); temperature = ((temperature - 255) * (40 / -255)).toFixed(2); console.log('temperature converted int: ', temperature); property.temperature = String(temperature); return property; })"}},"f6-02-01":{"send":{"01":"(function(){})"},"recive":{"01":"(function(data,enocean){if (data.raw === '50') {if (data.trigger === 0) {data.trigger = 1;console.log(1);var properties= {onoff: '1',optionalData:{trigger:data.trigger}};return properties;} else {data.trigger = 0;console.log(0);var properties= {onoff: '0',optionalData:{trigger:data.trigger}};return properties;}} else if(data.raw === '70'){if (data.trigger1 === 0) {data.trigger1 = 1;console.log(1);var properties= {onoff1: '1',optionalData:{trigger1:data.trigger1}};return properties} else {data.trigger1 = 0;console.log(0);var properties= {onoff1: '0',optionalData:{trigger1:data.trigger1}};return properties;}}})"}},"d5-00-01":{"send":{"01":"(function(){})"},"recive":{"01":"((function(data,enocean){var porta;if(data.raw == '08'){porta = '1';} else if(data.raw == '09'){porta = '0';}console.log(data.raw);var properties = {porta: porta};return properties;}))"}},"a5-20-01":{"send":{"01":"(function(dataObject,enocean,addInfo){   var property = {  temperature : '',  actuatorObstructed : '',  energySufficent : '',  setPoint : '',  setPointSelection : '',  valveOpenClose : '',  valvePosition : ''  };  console.log('dataObject: ',dataObject);  if(addInfo !== undefined){ console.log('original valvePosition: ', addInfo.setPoint.value); console.log('origina temperature: ', addInfo.temperature.value); property.valvePosition = parseInt((parseInt(addInfo.setPoint.value)*255/40)).toString(16); property.temperature = parseInt(255-(parseInt(addInfo.temperature.value)*255/40)).toString(16); } else { property.valvePosition = parseInt((parseInt(dataObject.message.value)*255/40)).toString(16); property.temperature = 'AC'; } console.log('valvePosition ',property.valvePosition);  if(property.valvePosition.length == 1){  property.valvePosition = '0' + property.valvePosition;  }  if(property.temperature.length == 1){ property.temperature = '0' + property.temperature;  } var optionalLenght = 'calculate';   var packetType = '01';    var dataLenght = 'calculate';    var choise = 'a5';  var row = property.valvePosition + property.temperature + '81' + '08';   console.log('row: ',row);  var senderId = enocean.base;    var status = '00';    var subTelNum = '03';    var destinationId = dataObject.protocol.address;    var securityLevel = '00';    var dBm = 'ff';    var optionalData = subTelNum + destinationId + dBm + securityLevel;    var data = choise + row + senderId + status;  dataLenght = data;    console.log('data lenght', (dataLenght.length) / 2);    dataLenght = ((dataLenght.length) / 2).toString(16);    if (dataLenght.length === 1) {   dataLenght = '000' + dataLenght;    } else if (dataLenght.length === 2) {   dataLenght = '00' + dataLenght;    } else if (dataLenght.length === 3) {   dataLenght = '0' + dataLenght;   }    optionalLenght = optionalData;    console.log('optionalLenght lenght in decimale', (optionalLenght.length) / 2);    optionalLenght = ((optionalLenght.length) / 2).toString(16);    if (optionalLenght.length === 1) {   optionalLenght = '0' + optionalLenght;    }    console.log('optionalLenght length hex', optionalLenght);    data += optionalData;    var header = dataLenght + optionalLenght + packetType;    return { header : header, data : data } })"},"recive":{"01":"(function(data, enocean) { var property = { temperature: '', actuatorObstructed: '', energySufficent: '', valveOpenClose: '' }; property.temperature = String((parseInt(data.raw.substring(4, 6), 16) * 40 / 255).toFixed(2)); property.actuatorObstructed = parseInt(data.raw.substring(2, 4), 16).toString(2)[7]; property.valveOpenClose = String(parseInt(data.raw.substring(0, 3), 16)); if(property.valveOpenClose != '64'){ property.valveOpenClose = '1'; } else { property.valveOpenClose = '0'; } if (property.actuatorObstructed === undefined) { property.actuatorObstructed = '0'; } property.energySufficent = parseInt(data.raw.substring(2, 4), 16).toString(2)[3]; property.valveOpenClose = parseInt(data.raw.substring(2, 4), 16).toString(2)[4]; console.log('return***** ', property); return property; })"}}}}
